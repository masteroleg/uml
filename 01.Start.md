# Этап 1: Регистрация и начало смены

## Цель
1. Обеспечить готовность оборудования и материалов.
2. Выполнить логин операторов на рабочем месте перед началом работы.
3. Обеспечить выбор паллеты оператором: продолжить незакрытую паллету или начать новую. Одновременно в работе может быть не более одной незавершённой и одной активной паллеты.

## Действия

### 1. Проверка оборудования и поддонов
1.1 Проверить готовность поддонов и оборудования.
1.2 Убедиться в соблюдении техники безопасности перед началом смены.
1.3 Убедиться, что всё соответствует требованиям для начала рабочего процесса.

### 2. Логин и привязка рабочего места
2.1 После успешного логина всех операторов на экране появляется сообщение: "Нужно привязать рабочее место к линии. Отсканируйте при помощи ручного сканера QR-код на баке реактора."
2.2 После группового логина, когда вся смена завершает процесс авторизации, оператор на своём пакере (дозаторе) завершает авторизацию. Затем оператор должен привязать своё рабочее место к линии путём сканирования QR-кода, который закреплён на реакторе.
2.3 Если QR-код не удаётся отсканировать, оператор должен сообщить об этом мастеру смены для устранения проблемы. Без этой привязки оператор не сможет получить задания или увидеть незавершённые паллеты, связанные с данной линией.

### 3. Выбор задания
3.1 Если на линии есть открытая паллета, оператору предлагается продолжить работу с ней или выбрать новое задание из списка заданий, назначенных на эту линию (рабочий центр). Выбор возможен только на этапе начала смены.
3.2 Если оператор решает не завершать незавершённую паллету, ему остаётся только один выбор — начать новый поддон. Система блокирует дальнейшую работу, отображая красное предупреждающее сообщение на экране и звуковое уведомление, до тех пор, пока оператор не примет решение.
3.3 Если оператор продолжает игнорировать предупреждение, система автоматически останавливает рабочий процесс и уведомляет руководство для принятия мер. Оператор не сможет продолжить выполнение других задач до тех пор, пока не завершит паллету или не примет соответствующее решение.
3.4 Если оператор не выберет новое задание, работа не начнётся, и на экране будет отображаться интерфейс выбора задания до тех пор, пока оно не будет выбрано.

### 4. Уведомления о незавершённой паллете
4.1 Система Traceavit-Pro отслеживает наличие одной незавершённой паллеты и предоставляет визуальные и звуковые уведомления оператору, чтобы предотвратить ошибки.
4.2 Уведомления появляются каждые 5 минут до тех пор, пока оператор не примет необходимые меры.
4.3 Завершение незавершённой паллеты возможно только на этапе начала смены. Если оператору необходимо завершить паллету на другом этапе, он должен завершить смену и повторить процесс логина.

### 5. Начало новой задачи
5.1 Если оператор выбирает новую задачу, открытая паллета остаётся в стороне и приостанавливается до её завершения, либо её нужно будет обработать позже.
5.2 Одновременно в работе может быть не более одной открытой и одной активной паллеты.
5.3 Система напоминает о незавершённой паллете при начале работы и блокирует возможность продолжения, пока оператор не примет решение по этой паллете.

### 6. Проверка голубой зоны (зона временного хранения, где канистры проходят стадию стабилизации перед дальнейшей обработкой)
6.1 Оператор на экране видит количество канистр, зарегистрированных в голубой зоне после окончания работы предыдущей смены, и подтверждает это количество.
6.2 Зона успокоения может содержать канистры достаточно долго, пока продукция не стабилизируется.
6.3 Если количество не соответствует, оператор должен пересканировать все коды в голубой зоне, так как изменение количества невозможно и может привести к ошибкам в системе учёта продукции.
6.4 После пересканирования оператор должен подтвердить корректировку, чтобы сохранить изменения.
6.5 Если корректировка не выполнена или не подтверждена, канистры автоматически попадают в оранжевую зону (зону подозрительных канистр).

## Условие выхода
1. Все оборудование и материалы проверены, и система готова к рабочему циклу.
2. Оператор либо выбрал продолжение работы с незакрытой паллетой, либо начал работу с новой паллетой.
3. Проверка голубой зоны завершена, и продукция переведена в соответствующую зону для дальнейших действий.

```mermaid
flowchart TD
    %% Узлы
    Start[Начало смены] --> Login[Групповой логин]
    Login --> LineBind[Привязка к линии]
    LineBind -->|QR-код успешно| Tasks[Список заданий из ERP]
    LineBind -->|Ошибка QR-кода| QRFail[Сообщить мастеру]
    Tasks --> TaskSelect[Выбор задания]
    TaskSelect --> PendingTasks[Незавершённые задачи]
    PendingTasks --> TaskDetails[Детали задания]
    TaskDetails -->|Есть паллета| PalletConfirm[Подтверждение паллеты]
    TaskDetails -->|Новая задача| NewTask[Информация о продукте]
    PalletConfirm -->|Ок количество| ToProduction[На производство]
    PalletConfirm -->|Не ок| Inventory[Инвентаризация]
    NewTask --> ToProduction
    Inventory --> ToProduction
    ToProduction --> BlueZone[Проверка голубой зоны]
    BlueZone -->|Ок количество| NextStep[Следующий этап]
    BlueZone -->|Не ок| Rescan[Пересканирование]
    Rescan -->|Все найдены| NextStep
    Rescan -->|Часть утеряна| ToOrange[В оранжевую зону]

    %% Стили узлов
    style BlueZone fill:#87CEEB,stroke:#000,stroke-width:2px,rx:10px,ry:10px
    style ToOrange fill:#FFA07A,stroke:#000,stroke-width:2px,rx:10px,ry:10px
    style PalletConfirm fill:#FFD700,stroke:#000,stroke-width:2px,rx:10px,ry:10px
    style ToProduction fill:#32CD32,stroke:#000,stroke-width:2px,rx:10px,ry:10px
